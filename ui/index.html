<!DOCTYPE html>
<meta charset="utf-8"/>
<title>WebSocket Test</title>


<button onclick="install()"> Install</button>

<script src="json/json2.js" type="text/javascript"></script>

<script language="javascript" type="text/javascript">

    //type ContainerInfo struct {
    //	Name      string `json:"Name" description:"name of container'"`
    //	User      string `json:"User" description:"user id of container"`
    //	Describe  string `json:"Describe" description:"additional description information"`
    //	BaseImage string `json:"BaseImage description:""`
    //	Command   string `json:"Command" description:"command"`

    //	Id        string `json:"Id" description:"uniquely identifies of container"`
    //	Ip        string `json:"Ip" description:"container's ip"`
    //	State     int    `json:"State" description:"the current status of the container, running, stopped, paused..."`
    //	Created   int64  `json:"Created" description:"created time"`
    //	PlayerId  string `json:"PlayerId" description:""`
    //}


    var wsUri = "ws://localhost:8081/ws";
    var output;

    function init() {
        output = document.getElementById("output");
        testWebSocket();
    }

    function install() {
        var installInfo = JSON.stringify({
            "Name": "tomcat",
            "User": "6",
            "Describe": "test tomcat",
            "BaseImage": "tomcat:latest",
            "Command": "docker run -d -p 9090:8080 tomcat"
        });
        var wsmInfo = JSON.stringify({
            "MessageType": 2,
            "Sender": "6",
            "Receiver": "",
            "Content": installInfo
        });
        doSend(wsmInfo);
    }

    function testWebSocket() {
        websocket = new WebSocket(wsUri);
        websocket.onopen = function (evt) {
            onOpen(evt)
        };
        websocket.onclose = function (evt) {
            onClose(evt)
        };
        websocket.onmessage = function (evt) {
            onMessage(evt)
        };
        websocket.onerror = function (evt) {
            onError(evt)
        };
    }

    function onOpen(evt) {
        var loginInfo = JSON.stringify({
            "MessageType": 1,
            "Sender": "6",
            "Receiver": "",
            "Content": ""
        });
        doSend(loginInfo);
    }

    function onClose(evt) {
        writeToScreen("DISCONNECTED");
    }

    function onMessage(evt) {
        writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data + '</span>');
    }

    function onError(evt) {
        writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
    }

    function doSend(message) {
        writeToScreen("SENT: " + message);
        websocket.send(message);
    }

    function writeToScreen(message) {
        var pre = document.createElement("p");
        pre.style.wordWrap = "break-word";
        pre.innerHTML = message;
        output.appendChild(pre);
    }

    window.addEventListener("load", init, false);
</script>
<h2>WebSocket Test</h2>
<div id="output"></div>
</html>